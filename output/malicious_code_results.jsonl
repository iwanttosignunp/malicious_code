{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "DeleteFileA(FileName);", "describe": "该代码片段 `DeleteFileA(FileName);` 是恶意软件中用于删除文件的一个关键操作。具体来说，这段代码通过调用Windows API中的 `DeleteFileA` 函数来删除指定的文件。此操作通常出现在恶意软件的清理阶段，目的是删除临时文件或其他痕迹，以掩盖其活动并防止被检测到。\n\n在Silver Fox APT的攻击链中，该恶意代码片段的具体作用如下：\n\n1. **清理痕迹**：恶意软件在执行过程中可能会创建一些临时文件，如日志文件、配置文件等。这些文件可能会暴露恶意软件的存在。为了隐藏这些证据，恶意软件会在完成其主要任务后删除这些文件。\n   \n2. **避免检测**：删除临时文件有助于降低被安全软件检测到的风险。安全软件通常会监控系统中的异常文件创建和删除行为。通过删除这些临时文件，恶意软件可以减少被发现的概率。\n\n3. **维持持久性**：在某些情况下，恶意软件可能会将自身的一些组件或配置存储在临时文件中。当恶意软件需要保持长期驻留时，删除这些临时文件可以防止安全研究人员追踪其活动路径。\n\n结合整个攻击链来看，恶意软件首先通过一个伪造的税务通知邮件作为诱饵，诱导用户下载并打开恶意附件。一旦用户点击附件，恶意软件会在用户的计算机上下载并执行一系列恶意组件，包括使用Nullsoft Scriptable Install System (NSIS) 安装器进行安装，并通过合法的可执行文件（如Thunder.exe）加载恶意的动态链接库（如libexpat.dll）。恶意软件随后会执行一系列复杂的反调试和沙箱检测措施，以确保其能够在受感染的系统上成功运行。\n\n最后，在完成所有必要操作之后，恶意软件会通过 `DeleteFileA` 删除临时文件，从而清除其活动痕迹，降低被检测的风险。这种行为展示了恶意软件的高度复杂性和隐蔽性，使得其能够长时间潜伏在受害者的系统中而不被察觉。", "format_code": "DeleteFileA(FileName);", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "lstrcatA(PathName, \"\\nsu.tmp\");", "describe": "该代码片段 `lstrcatA(PathName, \"\\nsu.tmp\");` 是恶意软件的一部分，用于在系统中创建一个临时目录，并将特定的文件放置于其中。具体来说，它通过将字符串 `\"\\nsu.tmp\"` 追加到变量 `PathName` 中，从而形成一个新的路径名。这个路径名指向一个临时目录，通常用于存储恶意软件的中间阶段文件。\n\n在恶意软件的上下文中，这段代码通常用于确保恶意载荷能够在一个相对隐蔽的位置执行。以下是该代码的具体功能和恶意行为：\n\n1. **创建临时目录**：`lstrcatA` 函数将字符串 `\"\\nsu.tmp\"` 追加到 `PathName` 变量中，形成一个完整的路径名。这表示恶意软件试图在系统的某个位置（通常是临时目录）创建一个名为 `su.tmp` 的子目录。\n\n2. **隐藏恶意活动**：使用临时目录（如 `C:\\Windows\\Temp`）来存放恶意载荷是一种常见的隐蔽手段，因为这些位置通常不会引起用户的注意。恶意软件通过这种方式可以避免被用户发现，同时也可以逃避某些安全工具的检测。\n\n3. **动态载荷加载**：恶意软件可能利用这个临时目录来存储解密后的载荷或插件。例如，下载的插件或其他恶意二进制文件会存放在 `su.tmp` 目录下，然后从那里加载并执行。\n\n4. **持久化机制**：如果恶意软件需要在系统中长期存在，它可能会利用这个临时目录来存储持久化的配置或数据。通过这种方式，恶意软件可以在系统重启后重新激活。\n\n总结来说，该代码片段是恶意软件生命周期中的一个关键步骤，它帮助恶意软件创建一个隐蔽的环境以执行进一步的恶意操作。通过将载荷放置在临时目录中，恶意软件能够更有效地隐藏其活动，从而增加感染的成功率和持久性。", "format_code": "lstrcatA(PathName,\"\\nsu.tmp\");", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "CreateDirectoryA(PathName, 0);", "describe": "该恶意代码片段的功能是创建一个目录。具体来说，它使用 `CreateDirectoryA` 函数在指定的路径（`PathName`）下创建一个新的目录。以下是该代码片段的具体分析：\n\n1. **功能分析**：\n   - `CreateDirectoryA` 是 Windows API 中的一个函数，用于创建一个新的目录。\n   - 参数 `PathName` 表示要创建的目录路径。\n   - 第二个参数设置为 `0`，表示不传递安全属性，即使用默认的安全属性。\n\n2. **恶意行为分析**：\n   - 在恶意软件中，创建目录通常是为了在系统中建立一个持久化点，以便后续操作。\n   - 特别是在恶意软件感染过程中，创建目录可以用来存放其他恶意文件或配置文件，从而实现长期驻留和控制。\n\n3. **攻击手法和技术细节**：\n   - 在此案例中，恶意软件通过创建目录来准备后续的恶意活动，例如下载并执行其他恶意组件。\n   - 创建目录的位置通常是临时目录（如 `%TEMP%`），以减少被用户发现的可能性。\n   - 该代码片段通常会与其他恶意操作（如下载文件、执行进程等）结合使用，形成一个完整的恶意软件执行链。\n\n综上所述，该恶意代码片段通过创建目录来为后续的恶意活动提供支持，是一种典型的恶意软件持久化手段。", "format_code": "CreateDirectoryA(PathName,0);", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "SetCurrentDirectoryA(PathName);", "describe": "该代码片段 `SetCurrentDirectoryA(PathName);` 是恶意软件在执行过程中用于更改当前工作目录的关键操作。结合整个文档中的上下文分析，此操作具有明确的恶意意图和技术细节，具体如下：\n\n1. **功能及恶意行为**:\n   - `SetCurrentDirectoryA` 函数用于将当前工作目录更改为指定的路径。在恶意软件中，这个函数通常被用来隐藏其实际运行位置，以规避检测和分析。\n   - 在此特定场景中，`PathName` 通常是恶意软件通过其他手段创建的一个临时目录（例如 `\\~nsu.tmp`），该目录通常位于系统临时文件夹内（如 `C:\\Windows\\Temp`）。\n\n2. **攻击手法与技术细节**:\n   - **临时目录创建**: 恶意软件首先使用 `GetTempPathA` 获取一个可写的临时目录，并在此基础上创建一个特定的工作目录（如 `\\~nsu.tmp`）。这一步骤确保了恶意软件可以在一个相对安全的位置进行后续操作，避免被安全软件轻易发现。\n   - **更改工作目录**: 通过调用 `SetCurrentDirectoryA` 将当前工作目录更改为刚刚创建的临时目录，使得后续的文件操作（如下载、解密和执行恶意载荷）都在这个临时目录下进行。\n   - **进程注入**: 在更改目录之后，恶意软件会从这个临时目录加载并执行恶意载荷，如 `Thunder.exe` 和 `libexpat.dll`。这些载荷通常包含进一步的恶意行为，如 DLL 劫持、进程注入等。\n   - **持久化机制**: 恶意软件还会利用注册表存储配置信息和插件，以实现长期驻留和隐蔽性。例如，它会在 `HKCU\\Console\\0\\d33f351a4aeea5e608853d1a56661059` 下存储插件数据，确保即使系统重启也能恢复执行。\n\n总结来说，`SetCurrentDirectoryA(PathName);` 这一操作是恶意软件在执行过程中隐藏自身、创建安全执行环境的重要步骤，旨在降低被检测的风险，同时为后续的恶意行为奠定基础。", "format_code": "SetCurrentDirectoryA(PathName);", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "v4 = IsDebuggerPresent();\nToolHelp32Snapshot = CreateToolhelp32Snapshot(2u, 0);", "describe": "该恶意代码片段是Valley RAT的一部分，主要功能是检测调试器的存在并执行进程枚举操作。具体来说，它通过以下方式实现恶意行为和技术细节：\n\n1. **检测调试器**：`v4 = IsDebuggerPresent();`\n   - 这行代码调用`IsDebuggerPresent()`函数来检查当前环境中是否存在调试器。如果存在调试器，则返回非零值，否则返回零值。\n   - 该操作是典型的反调试技术，目的是在调试环境下阻止恶意软件的正常运行，从而避免被安全研究人员分析和逆向工程。\n\n2. **创建快照并枚举进程**：`ToolHelp32Snapshot = CreateToolhelp32Snapshot(2u, 0);`\n   - `CreateToolhelp32Snapshot`函数用于创建当前系统中所有进程的快照。参数`2u`表示`TH32CS_SNAPPROCESS`标志，意味着获取所有进程的快照；第二个参数`0`表示进程ID（PID），设置为`0`表示获取所有进程的快照。\n   - 一旦快照创建成功，恶意软件可以使用`Process32First`和`Process32Next`等函数枚举所有进程，进一步识别和操作目标进程，例如查找并注入特定的进程。\n\n结合上下文，这些反调试和进程枚举的技术使得Valley RAT能够在复杂的网络环境中保持隐蔽性，并且能够有效地绕过安全防御机制。具体而言，反调试技术确保了恶意软件不会在调试环境中运行，从而避免了安全研究人员的直接分析。而进程枚举技术则允许恶意软件识别并操控关键进程，如`explorer.exe`，以实现持久化和远程控制等功能。\n\n此外，这些技术还增强了恶意软件的隐蔽性和持久性，使其能够在受害者的系统中长期驻留而不被轻易发现。通过这些手段，Silver Fox APT能够维持对印度企业和用户的长期监控和数据窃取活动。", "format_code": "v4=IsDebuggerPresent();ToolHelp32Snapshot=CreateToolhelp32Snapshot(2u,0);", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "if (v4)\n{\nLogStatus((char *)&Format_2);\nreturn 0;\n}", "describe": "该代码片段是恶意软件中的一部分，用于处理调试检测。具体来说，它检查是否处于调试环境中，并根据结果执行不同的操作：\n\n```c\nif (v4)\n{\n    LogStatus((char *)&Format_2);\n    return 0;\n}\n```\n\n其中，`v4` 是一个布尔值，表示是否检测到调试器的存在。如果 `v4` 为真，即检测到调试环境，恶意软件将调用 `LogStatus` 函数记录日志，并立即返回，从而终止当前的执行流程。这表明恶意软件具有反调试机制，能够检测并响应调试环境，以避免被分析和逆向工程。\n\n这种反调试技术通常通过调用 `IsDebuggerPresent()` 系统函数来实现，该函数会检查当前进程是否正在被调试器监控。如果检测到调试器，恶意软件会采取相应的措施，如终止自身或改变行为模式，以增加分析难度。\n\n具体到这段代码，当检测到调试环境时，恶意软件会记录一条特定的日志信息（由 `Format_2` 定义），然后直接返回，中断了正常的执行流程。这不仅有助于隐藏恶意行为，还能有效防止安全研究人员对其进行深入分析。\n\n总结来说，这段代码展示了恶意软件的反调试特性，通过检测调试环境并立即退出来规避分析，体现了高度的技术复杂性和隐蔽性。", "format_code": "if(v4){LogStatus((char*)&Format_2);return0;}", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "DisableWindowsUpdateService()\nLoadAndDecryptPayload(Block)\nProcessHollowing((int)Block)\nCreateThread(0, 0, StartAddress, 0, 0, 0)", "describe": "### 恶意代码片段分析\n\n#### 1. DisableWindowsUpdateService()\n这段代码的功能是禁用Windows Update服务（wuauserv）。通过禁用Windows Update服务，恶意软件可以防止系统自动更新和安装安全补丁。这使得恶意软件能够在目标系统上长期驻留而不被检测到或移除。禁用Windows Update服务是常见的恶意软件策略之一，旨在延长恶意软件的存活时间并减少被发现的风险。\n\n#### 2. LoadAndDecryptPayload(Block)\n此函数从磁盘加载一个加密的有效负载，并将其解密。恶意软件通常会将有效负载进行加密以避免被反病毒软件检测。`LoadAndDecryptPayload` 函数负责解密这些数据，并将其加载到内存中。这种技术能够确保有效负载在传输过程中不被轻易识别，从而增加了恶意软件的隐蔽性。\n\n#### 3. ProcessHollowing((int)Block)\n进程空洞化（Process Hollowing）是一种高级的技术，它利用合法进程的内存空间来注入恶意代码。`ProcessHollowing` 函数通过创建一个合法进程（如 `explorer.exe`），然后将恶意代码注入到该进程的内存中，并替换掉合法代码。这种方式使得恶意代码能够在合法进程的保护下运行，从而逃避检测。此外，由于使用了合法进程，杀毒软件很难区分出其中的恶意活动。\n\n#### 4. CreateThread(0, 0, StartAddress, 0, 0, 0)\n此函数用于创建一个新的线程来执行恶意代码。`CreateThread` 函数接受多个参数，包括起始地址 (`StartAddress`)，该地址指向要执行的恶意代码。通过创建新线程，恶意软件可以在后台运行而不影响系统的正常操作，同时还能绕过一些简单的进程监控机制。这种方式有助于保持恶意软件的隐蔽性和持久性。\n\n### 恶意行为与攻击手法\n\n上述代码片段展示了恶意软件如何通过一系列复杂的步骤实现隐蔽性和持久性。首先，通过禁用Windows Update服务，恶意软件确保自身不会因为系统更新而被移除。其次，通过加密有效负载并使用进程空洞化技术，恶意软件能够在目标系统上长时间驻留而不被检测。最后，通过创建新的线程来执行恶意代码，恶意软件能够进一步隐藏自己的存在，降低被发现的风险。\n\n这些技术的组合使得恶意软件能够在目标系统上长期驻留，持续收集敏感信息并执行其他恶意操作。对于防御者来说，识别和应对这类复杂的恶意软件需要采用多层次的安全措施，包括实时监控、行为分析以及定期的安全更新。", "format_code": "DisableWindowsUpdateService()LoadAndDecryptPayload(Block)ProcessHollowing((int)Block)CreateThread(0,0,StartAddress,0,0,0)", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "v13 = (void *)*((_DWORD *)Block[0] - 1);\nsub_10003E6E(v13);", "describe": "该恶意代码片段涉及从内存中提取并执行一个解密后的有效载荷。具体分析如下：\n\n1. **功能与恶意行为**：\n   - `v13 = (void *)*((_DWORD *)Block[0] - 1);`：这段代码从 `Block[0]` 地址前一个 `_DWORD` 处读取一个指针值，并将其赋给 `v13`。这通常意味着 `Block[0]` 是一个已解密的有效载荷的起始地址，而 `Block[0] - 1` 处存储了指向有效载荷起始地址的指针。\n   - `sub_10003E6E(v13);`：调用函数 `sub_10003E6E` 并传递 `v13` 作为参数。这个函数很可能是用于执行或进一步处理解密后的有效载荷。\n\n2. **攻击手法和技术细节**：\n   - **内存操作**：通过从内存中读取指针来定位解密后的有效载荷，这表明恶意软件使用了复杂的内存管理技术来隐藏和执行其有效载荷。\n   - **动态加载**：该代码片段展示了动态加载和执行代码的技术，这是一种常见的逃避检测的方法，因为代码不会写入磁盘，而是直接在内存中运行。\n   - **混淆技术**：通过将指针存储在解密数据之前的一个位置，恶意软件增加了逆向工程的难度，使得分析者难以直接找到有效载荷的起始位置。\n   - **多阶段载荷**：该代码片段是整个多阶段载荷中的一个部分，它负责从内存中提取并执行最终的有效载荷。这种设计可以确保即使某个阶段被检测到，后续阶段仍然能够继续执行，从而提高恶意软件的生存能力。\n\n综上所述，这段恶意代码片段通过复杂的内存操作和动态加载技术，在内存中执行解密后的有效载荷，以实现持久化和逃避检测的目的。", "format_code": "v13=(void*)*((_DWORD*)Block[0]-1);sub_10003E6E(v13);", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "if (!CreateProcessA(\n\"C:\\\\Windows\\\\SysWOW64\\\\explorer.exe\",\n0,\n0,\n0,\n0,\nCREATE_SUSPENDED | CREATE_NO_WINDOW,\n0,\n0,\n&StartupInfo,\n&ProcessInformation)\n)", "describe": "该恶意代码片段展示了创建并控制进程的恶意行为。具体而言，它通过调用`CreateProcessA`函数启动了`explorer.exe`进程，并设置了特定的参数来实现对进程的完全控制。以下是详细解释：\n\n1. **进程创建与挂起**：\n   ```c\n   if (!CreateProcessA(\n       \"C:\\\\Windows\\\\SysWOW64\\\\explorer.exe\",\n       0,\n       0,\n       0,\n       0,\n       CREATE_SUSPENDED | CREATE_NO_WINDOW,\n       0,\n       0,\n       &StartupInfo,\n       &ProcessInformation)\n   )\n   ```\n   - `CreateProcessA`用于创建一个新的进程及其主线程。此函数在创建进程时将其设置为挂起状态（`CREATE_SUSPENDED`），这意味着进程将被创建但不会立即执行。同时，`CREATE_NO_WINDOW`标志确保该进程不会显示窗口，从而隐藏恶意活动。\n   \n2. **控制进程**：\n   - 通过将进程设置为挂起状态，恶意代码可以在进程开始执行之前对其进行操作。这通常包括注入恶意代码或修改进程的行为。\n   \n3. **进程注入**：\n   - 在挂起状态下，恶意代码可以使用如`VirtualAllocEx`和`WriteProcessMemory`等API将恶意代码注入到`explorer.exe`进程中。随后，通过`ResumeThread`函数恢复进程执行，使得恶意代码得以执行。\n   \n4. **隐藏性**：\n   - 使用合法的系统进程（如`explorer.exe`）作为宿主进程有助于混淆检测，因为这些进程通常是用户信任的且经常运行。通过这种方式，恶意软件能够在受害者的系统中保持长期驻留而不被发现。\n\n总结来说，这段恶意代码通过创建并挂起一个合法的系统进程（`explorer.exe`），然后注入恶意代码，最终实现持久化和隐蔽性，这是典型的进程注入和进程劫持技术。", "format_code": "if(!CreateProcessA(\"C:\\\\Windows\\\\SysWOW64\\\\explorer.exe\",0,0,0,0,CREATE_SUSPENDED|CREATE_NO_WINDOW,0,0,&StartupInfo,&ProcessInformation))", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "CloseHandle(ProcessInformation.hThread);\nCloseHandle(ProcessInformation.hProcess);", "describe": "该代码片段是恶意软件的一部分，用于关闭由 `CreateProcessA` 函数创建的子进程及其线程句柄。具体来说，`CloseHandle(ProcessInformation.hThread)` 和 `CloseHandle(ProcessInformation.hProcess)` 分别关闭了子进程的线程句柄和进程句柄。这些操作确保了在完成必要的进程注入或执行后，不会留下未关闭的资源句柄，从而避免被检测工具发现异常。\n\n在恶意软件的上下文中，此代码片段通常出现在进程注入后的清理阶段。通过注入恶意代码到合法进程（如 `explorer.exe` 或 `tracerpt.exe`），攻击者可以隐藏恶意活动并逃避检测。例如，在上述分析中，恶意软件使用 `CreateProcessA` 创建一个挂起状态的目标进程（如 `explorer.exe`），然后注入恶意代码并恢复进程执行。一旦注入成功，恶意软件会关闭相应的句柄以清除痕迹。\n\n这种技术被称为进程注入，是一种常见的恶意软件技术，用于规避安全检测并实现持久化控制。通过将恶意代码注入到合法进程中，攻击者可以利用这些合法进程的权限和信任来执行各种恶意行为，包括但不限于远程命令执行、文件下载上传、键盘记录等。", "format_code": "CloseHandle(ProcessInformation.hThread);CloseHandle(ProcessInformation.hProcess);", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "fopen_s(&Stream, \"C:\\\\data.db\", \"ab+\");\nfwrite(Buffer_3, 1u, Size, Stream);", "describe": "该恶意代码片段的功能是将数据写入到本地文件系统中的一个特定文件中。具体来说，它首先通过 `fopen_s` 函数以追加模式（\"ab+\"）打开或创建一个名为 \"C:\\\\data.db\" 的文件，并将文件句柄赋值给变量 `Stream`。接着，使用 `fwrite` 函数将内存缓冲区 `Buffer_3` 中的数据写入到这个文件中。\n\n在恶意软件的上下文中，这种操作通常用于日志记录或持久化存储。恶意代码通过这种方式记录执行过程中的关键信息，如错误状态、配置参数等，这些信息可以帮助攻击者监控恶意软件的行为和状态。此外，这种持久化机制也使得恶意软件能够在重启后继续运行，因为相关配置和数据已经保存在本地文件中。\n\n具体的技术细节如下：\n1. **日志记录**：恶意代码通过写入日志来记录各种操作和状态，这有助于攻击者了解恶意软件的运行情况。\n2. **持久化**：将数据写入本地文件系统，确保恶意软件能够在系统重启后继续运行，从而实现长期驻留。\n3. **数据加密**：在写入前，恶意代码对数据进行了轻量级的混淆处理，这增加了检测和分析的难度。\n\n综上所述，该代码片段展示了恶意软件如何利用日志记录和持久化技术来实现长期驻留和隐蔽通信，同时通过简单的加密手段增加检测难度。", "format_code": "fopen_s(&Stream,\"C:\\\\data.db\",\"ab+\");fwrite(Buffer_3,1u,Size,Stream);", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "sub_405D70(\"L\\\"p1:\\\",\" Source, 0);\nsub_405D70(\"L\\\"o1:\\\",\" Source_2, 0);\nsub_405D70(\"L\\\"t1:\\\",\" 0, (int)&dword_41CA30);\nsub_405D70(\"L\\\"p2:\\\",\" Source_0, 0);\nsub_405D70(\"L\\\"o2:\\\",\" Source_1, 0);\nsub_405D70(\"L\\\"t2:\\\",\" 0, (int)&dword_41CC70);\nsub_405D70(\"L\\\"p3:\\\",\" Source_3, 0);\nsub_405D70(\"L\\\"o3:\\\",\" Source_4, 0);\nsub_405D70(\"L\\\"t3:\\\",\" 0, (int)&dword_41CE80);", "describe": "该恶意代码片段是Valley RAT恶意软件配置加载的一部分。它通过调用`sub_405D70`函数来解析并存储三个层级的命令与控制（C2）服务器地址及其相关参数。具体来说，这些参数包括：\n\n- `p1:`：主C2服务器地址\n- `o1:`：主C2服务器端口\n- `t1:`：主C2连接类型（HTTP/HTTPS 或原始TCP套接字）\n- `p2:`：备用C2服务器地址\n- `o2:`：备用C2服务器端口\n- `t2:`：备用C2连接类型\n- `p3:`：次级备用C2服务器地址\n- `o3:`：次级备用C2服务器端口\n- `t3:`：次级备用C2连接类型\n\n代码中的`Source`、`Source_2`、`Source_0`等变量代表了从配置文件中提取的具体值。这些值被存储在不同的内存位置，并通过`sub_405D70`函数进行解析和处理。\n\n这种多层次的C2架构设计使得恶意软件能够实现多级故障转移机制。如果主C2服务器不可用，恶意软件将尝试连接到备用C2服务器，甚至次级备用C2服务器。这提高了恶意软件在网络环境中的生存能力和隐蔽性。\n\n此外，Valley RAT还利用注册表驱动的动态C2更新机制，允许攻击者在不重新部署恶意软件的情况下更新C2服务器地址。这种技术大大增加了传统基于IP和域名封锁策略的有效性难度。\n\n总体而言，这段代码展示了Valley RAT如何配置和管理其复杂的C2基础设施，确保恶意软件能够在多种网络环境中持续运行并保持隐蔽。", "format_code": "sub_405D70(\"L\\\"p1:\\\",\"Source,0);sub_405D70(\"L\\\"o1:\\\",\"Source_2,0);sub_405D70(\"L\\\"t1:\\\",\"0,(int)&dword_41CA30);sub_405D70(\"L\\\"p2:\\\",\"Source_0,0);sub_405D70(\"L\\\"o2:\\\",\"Source_1,0);sub_405D70(\"L\\\"t2:\\\",\"0,(int)&dword_41CC70);sub_405D70(\"L\\\"p3:\\\",\"Source_3,0);sub_405D70(\"L\\\"o3:\\\",\"Source_4,0);sub_405D70(\"L\\\"t3:\\\",\"0,(int)&dword_41CE80);", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "sub_405D70(\"L\\\"dd:\\\",\" , word_41CEF0, 0);\nsub_405D70(\"L\\\"cl:\\\",\" , word_41CF2C, 0);\nsub_405D70(\"L\\\"bb:\\\",\" , &word_41CF4, 0);\nsub_405D70(\"L\\\"bb:\\\",\" , &word_41CFF4, 0);\nsub_405D70(\"L\\\"jp:\\\",\" , 0, (int)&unk_41D058);\nsub_405D70(\"L\\\"sx:\\\",\" , 0, (int)&unk_41D05C);\nsub_405D70(\"L\\\"bh:\\\",\" , 0, (int)&unk_41D060);\nsub_405D70(\"L\\\"ll:\\\",\" , 0, (int)&unk_41D064);\nsub_405D70(\"L\\\"dl:\\\",\" , 0, (int)&unk_41D06C);\nsub_405D70(\"L\\\"bd:\\\",\" , 0, (int)&unk_41D074);", "describe": "这段恶意代码片段是Valley RAT恶意软件的一部分，用于配置和初始化其各种功能。以下是对其功能、恶意行为及攻击手法的详细解释：\n\n### 功能描述\n代码通过调用`sub_405D70`函数来解析并设置多个参数。这些参数控制了Valley RAT的行为，包括其与命令与控制（C2）服务器的通信方式、功能开关等。具体来说，每个参数都对应于特定的功能或行为配置。\n\n### 参数解析\n- **dd:** 初始连接延迟时间（秒）\n- **cl:** 连接间隔时间（秒），即每次尝试连接C2服务器的时间间隔\n- **bb:** 构建/机器人版本标识符\n- **jp:** 未知功能标志\n- **sx:** 未知功能标志\n- **bh:** 未知功能标志\n- **ll:** 未知功能标志\n- **dl:** 文件下载/上传能力\n- **bd:** 完整后门模式\n\n### 恶意行为\nValley RAT通过这些参数实现了高度定制化的恶意行为。例如：\n- **初始连接延迟**：通过设置`dd:`参数，Valley RAT可以在初次启动时延迟一段时间再连接C2服务器，从而避免被即时检测到。\n- **连接间隔**：通过设置`cl:`参数，Valley RAT可以控制与C2服务器的连接频率，降低被发现的概率。\n- **功能开关**：通过不同的参数配置，Valley RAT可以开启或关闭特定功能，如远程shell访问（`sh`）、文件下载/上传（`dl`）、完整后门模式（`bd`）等。\n\n### 攻击手法和技术细节\nValley RAT采用了多种高级技术和手段来确保其持久性和隐蔽性：\n- **多级C2架构**：通过配置三个不同级别的C2服务器地址，Valley RAT能够在主服务器不可达时自动切换到备用服务器，提高了其稳定性。\n- **内存执行**：Valley RAT使用Donut加载器将恶意代码注入到合法进程（如`explorer.exe`）中，并在内存中执行，以逃避传统的基于磁盘的检测方法。\n- **注册表持久化**：Valley RAT利用注册表存储配置信息和插件，即使系统重启也能保持持久性。\n- **模块化扩展**：Valley RAT支持从C2服务器动态下载和执行插件，以实现更复杂的恶意行为，如高级键盘记录、凭证窃取等。\n\n综上所述，这段恶意代码片段展示了Valley RAT如何通过细致的配置管理来实现其隐蔽性、持久性和多功能性，使其成为一种高度复杂的恶意软件。", "format_code": "sub_405D70(\"L\\\"dd:\\\",\",word_41CEF0,0);sub_405D70(\"L\\\"cl:\\\",\",word_41CF2C,0);sub_405D70(\"L\\\"bb:\\\",\",&word_41CF4,0);sub_405D70(\"L\\\"bb:\\\",\",&word_41CFF4,0);sub_405D70(\"L\\\"jp:\\\",\",0,(int)&unk_41D058);sub_405D70(\"L\\\"sx:\\\",\",0,(int)&unk_41D05C);sub_405D70(\"L\\\"bh:\\\",\",0,(int)&unk_41D060);sub_405D70(\"L\\\"ll:\\\",\",0,(int)&unk_41D064);sub_405D70(\"L\\\"dl:\\\",\",0,(int)&unk_41D06C);sub_405D70(\"L\\\"bd:\\\",\",0,(int)&unk_41D074);", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "RegQueryValueExW(phkResult, L\"IpDate\", 0, &Type, (LPBYTE)a0Db1Lk1Hs0Ld0L, &cbData);", "describe": "该恶意代码片段是Valley RAT恶意软件的一部分，用于从Windows注册表中检索配置信息。具体来说，它通过调用`RegQueryValueExW`函数从注册表中的特定键值读取数据。以下是详细的解释：\n\n### 功能及恶意行为\n\n1. **注册表查询**:\n   ```cpp\n   RegQueryValueExW(phkResult, L\"IpDate\", 0, &Type, (LPBYTE)a0Db1Lk1Hs0Ld0L, &cbData);\n   ```\n   这段代码从注册表中读取名为 `IpDate` 的值，并将其存储到变量 `a0Db1Lk1Hs0Ld0L` 中。该操作用于获取恶意软件的配置信息，包括C2服务器地址和其他关键参数。\n\n2. **配置更新**:\n   如果注册表值存在且超过10字节，Valley RAT会完全替换其嵌入的配置，然后重新解析关键的C2参数（如 `p1` 到 `t3`）。这允许Silver Fox操作员在不重新部署新二进制文件或重新获得代码执行的情况下推送更新的C2地址。\n\n### 攻击手法和技术细节\n\n1. **持久性机制**:\n   - **注册表持久化**: 恶意软件使用注册表作为持久化的手段，将关键配置信息存储在 `HKEY_CURRENT_USER\\Console\\0` 下的一个特定值中。\n   - **动态配置更新**: 操作员可以通过C2服务器推送新的配置信息，使得恶意软件可以动态地更新其行为和通信方式。\n\n2. **多级C2基础设施**:\n   - 恶意软件支持三级C2服务器配置，分别为主服务器 (`p1`)、次级服务器 (`p2`) 和后备服务器 (`p3`)。如果主服务器连接失败，恶意软件会尝试连接次级服务器，直至成功。\n   - 使用混合协议支持（HTTP/HTTPS 和 原始TCP），增加了检测难度。\n\n3. **内存执行**:\n   - 恶意软件通过下载插件并在内存中执行，避免了直接写入磁盘的行为，从而降低了被检测的风险。\n   - 使用 `VirtualAllocEx` 分配可执行内存，并通过 `WriteProcessMemory` 将插件代码注入到合法进程（如 `tracerpt.exe`）中，实现无文件执行。\n\n4. **模块化扩展**:\n   - 模块化设计允许操作员根据需要动态部署高风险功能模块，如远程shell、文件上传/下载等。\n   - 插件通过C2服务器分发，确保灵活性和隐蔽性。\n\n### 总结\n\n该恶意代码片段展示了Valley RAT如何利用注册表来存储和更新其配置信息，以及如何通过多级C2服务器和内存执行技术实现持久性和隐蔽性。这些特性使得Valley RAT能够在受害系统上长期潜伏，同时保持较低的检测率。", "format_code": "RegQueryValueExW(phkResult,L\"IpDate\",0,&Type,(LPBYTE)a0Db1Lk1Hs0Ld0L,&cbData);", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "sub_405D70(L\"p1:\", Source, 0);\nsub_405D70(L\"o1:\", Source_2, 0);\nsub_405D70(L\"t1:\", 0, &dword_41CA30);\nsub_405D70(L\"p2:\", Source_0, 0);\nsub_405D70(L\"o2:\", Source_1, 0);\nsub_405D70(L\"t2:\", 0, &dword_41CC70);\nsub_405D70(L\"p3:\", Source_3, 0);\nsub_405D70(L\"o3:\", Source_4, 0);\nsub_405D70(L\"t3:\", 0, &dword_41CEB0);", "describe": "该恶意代码片段是Valley RAT的一部分，用于配置和初始化恶意软件的命令与控制（C2）基础设施。具体来说，它通过调用`sub_405D70`函数来设置多个C2服务器地址、端口号及连接类型。以下是详细解释：\n\n### 功能和恶意行为\n\n1. **C2 Server Addresses**:\n   - `p1:`: 主C2服务器地址\n   - `p2:`: 备用C2服务器地址\n   - `p3:`: 第三备选C2服务器地址\n\n2. **Port Numbers**:\n   - `o1:`: 对应主C2服务器的端口号\n   - `o2:`: 对应备用C2服务器的端口号\n   - `o3:`: 对应第三备选C2服务器的端口号\n\n3. **Connection Types**:\n   - `t1:`: 主C2服务器的连接类型（1表示HTTP/HTTPS，0表示原始TCP套接字）\n   - `t2:`: 备用C2服务器的连接类型\n   - `t3:`: 第三备选C2服务器的连接类型\n\n### 攻击手法和技术细节\n\n1. **多级C2 Failover机制**:\n   - 如果主C2服务器不可达，恶意软件会尝试连接备用C2服务器。如果备用服务器也不可达，则会尝试连接第三备选C2服务器。这种机制提高了恶意软件的生存能力和隐蔽性，使得静态IP或域名封锁变得无效。\n\n2. **动态更新C2配置**:\n   - 恶意软件还从Windows注册表中读取并更新C2服务器配置。这允许攻击者在不重新部署恶意软件的情况下，动态更改C2服务器地址，从而避免检测和阻断。\n\n3. **多协议支持**:\n   - 恶意软件支持HTTP/HTTPS和原始TCP协议，增加了网络通信的复杂性和隐蔽性。通过切换不同的协议，恶意软件可以绕过基于特定协议的检测规则。\n\n4. **内存执行和持久化**:\n   - Valley RAT采用Donut生成的shellcode，并在内存中执行。这种技术避免了将恶意代码写入磁盘，从而减少了被反病毒软件检测的风险。此外，恶意软件通过在注册表中存储插件，实现了跨重启的持久化。\n\n5. **模块化扩展**:\n   - 恶意软件支持模块化插件系统，通过C2服务器下载插件，并在内存中执行。这些插件可以提供额外的功能，如高级键盘记录、凭证收集等。插件在注入到合法进程中时，会被修改以包含C2地址和其他配置参数。\n\n综上所述，这段恶意代码通过多级C2配置、动态更新和多种协议支持，增强了其隐蔽性和持久性。同时，通过内存执行和模块化扩展，提高了恶意软件的灵活性和攻击能力。", "format_code": "sub_405D70(L\"p1:\",Source,0);sub_405D70(L\"o1:\",Source_2,0);sub_405D70(L\"t1:\",0,&dword_41CA30);sub_405D70(L\"p2:\",Source_0,0);sub_405D70(L\"o2:\",Source_1,0);sub_405D70(L\"t2:\",0,&dword_41CC70);sub_405D70(L\"p3:\",Source_3,0);sub_405D70(L\"o3:\",Source_4,0);sub_405D70(L\"t3:\",0,&dword_41CEB0);", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "result = CreateProcessA(Buffer, 0, 0, 0, 0, CREATE_SUSPENDED, 0, 0, &StartupInfo, lpProcessInformation);", "describe": "该恶意代码片段展示了如何通过 `CreateProcessA` 函数创建一个被挂起的进程。具体来说，这段代码执行了以下几个步骤：\n\n1. **创建被挂起的进程**：使用 `CreateProcessA` 创建一个新的进程，并将其设置为挂起状态（`CREATE_SUSPENDED` 标志）。这意味着新进程不会立即开始执行，而是处于暂停状态，等待进一步的操作。\n\n2. **参数解析**：\n   - `Buffer` 是要执行的可执行文件路径，通常指向合法的系统工具如 `tracerpt.exe`。\n   - `StartupInfo` 包含了启动信息结构体，用于指定进程的启动方式。\n   - `lpProcessInformation` 是一个指向 `PROCESS_INFORMATION` 结构体的指针，用于接收新进程的信息。\n\n3. **注入恶意代码**：一旦进程被成功挂起，恶意软件会分配内存空间（使用 `VirtualAllocEx`）并将恶意代码写入该进程中（使用 `WriteProcessMemory`），然后修改线程上下文以使进程从恶意代码开始执行（使用 `SetThreadContext` 和 `ResumeThread`）。\n\n这种技术被称为 **进程注入**，它允许恶意软件在合法的进程中运行恶意代码，从而绕过安全检测并提高隐蔽性。具体来说，恶意软件利用合法程序（如 `tracerpt.exe`）作为宿主，将自身注入到该进程中，使得恶意行为更加难以检测。这种方法不仅能够规避基于签名的检测，还能利用合法程序的权限进行操作，增加了攻击的成功率。\n\n总结来说，这段代码通过创建被挂起的合法进程，注入恶意代码，并最终激活恶意进程，实现了隐蔽的恶意行为，提高了攻击的隐蔽性和持久性。", "format_code": "result=CreateProcessA(Buffer,0,0,0,0,CREATE_SUSPENDED,0,0,&StartupInfo,lpProcessInformation);", "hash": "hash"}
{"file_name": "fed9c11a-b86a-49a9-a9e2-24332f01a81c.md", "title": "Silver Fox Targeting India Using Tax Themed Phishing Lures", "malicious_code": "ResumeThread(lpProcessInformation->hThread);", "describe": "该代码片段的功能是恢复一个被挂起的线程，即 `ResumeThread(lpProcessInformation->hThread);`。这一操作在恶意软件中通常用于执行注入的恶意载荷。具体来说，这段代码位于一个更广泛的进程注入机制中，该机制首先创建了一个目标进程（如 `tracerpt.exe`）并将其置于挂起状态，然后将恶意代码注入到该进程的内存中，并修改线程上下文以使执行转向恶意载荷。最后，通过调用 `ResumeThread` 函数来恢复被挂起的线程，从而启动恶意代码的执行。\n\n这种技术被称为进程注入，是一种常见的恶意软件技术，能够绕过操作系统的一些安全检测机制。通过将恶意代码注入到合法进程的内存空间中，攻击者可以利用合法进程的权限执行恶意操作，同时降低被检测的风险。此外，由于注入的代码是在内存中执行的，因此不会留下明显的文件痕迹，进一步增加了检测难度。\n\n在本例中，Valley RAT 使用了这种技术来注入从命令与控制服务器下载的插件，并通过修改线程上下文来确保恶意代码能够在目标进程中被执行。这种技术结合了进程注入、内存执行以及注册表持久化等手段，使得恶意软件能够在系统中长期潜伏并执行各种恶意活动，包括但不限于键盘记录、远程命令执行、文件传输等。\n\n综上所述，该代码片段展示了恶意软件如何通过进程注入技术实现隐蔽执行，并最终激活恶意功能，体现了其高度的恶意性质和技术复杂性。", "format_code": "ResumeThread(lpProcessInformation->hThread);", "hash": "hash"}
